<?xml version='1.0'?>
<sdf version='1.6'>
  <model name="my_robot">
    <!-- must be dynamic for wheels to spin -->
    <static>false</static>

    <!-- Model origin at ground; we lift the chassis a bit in its own pose -->
    <pose>0 0 0 0 0 0</pose>

    <link name='chassis'>
      <!-- box: 0.4 x 0.2 x 0.1, center z = 0.11 gives ~1 cm clearance above 0.05m-radius wheels -->
      <pose>0 0 0.11 0 0 0</pose>

      <inertial>
        <mass>1.0</mass>
        <!-- Rough box inertia for 0.4 x 0.2 x 0.1 m, m=1 kg -->
        <inertia>
          <ixx>0.00417</ixx> <!-- 1/12*m*(y^2+z^2) -->
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.01417</iyy> <!-- 1/12*m*(x^2+z^2) -->
          <iyz>0.0</iyz>
          <izz>0.01667</izz> <!-- 1/12*m*(x^2+y^2) -->
        </inertia>
      </inertial>

      <collision name='chassis_collision'>
        <geometry>
          <box><size>0.4 0.2 0.1</size></box>
        </geometry>
        <surface>
          <friction>
            <ode><mu>1.0</mu><mu2>1.0</mu2></ode>
          </friction>
        </surface>
      </collision>

      <visual name='chassis_visual'>
        <geometry>
          <box><size>0.4 0.2 0.1</size></box>
        </geometry>
        <material><ambient>0.2 0.2 0.25 1</ambient></material>
      </visual>
    </link>

    <!-- Useful constants for wheel placement:
         chassis half-length = 0.20 (x), half-width = 0.10 (y)
         choose wheel x offsets = Â±0.15, y offsets = Â±0.12 (slightly outside)
         wheel center z = radius = 0.05
    -->

    <!-- =============== Wheel template (radius=0.05, width=0.02) =============== -->
    <!-- Front-Left (x=+0.15, y=+0.12) -->
    <link name='wheel_fl'>
      <!-- roll 90deg so cylinder axis aligns with Y -->
      <pose>0.15 0.12 0.05 1.5707963 0 0</pose>
      <inertial>
        <mass>0.2</mass>
        <!-- Solid cylinder inertia, axis along Y -->
        <inertia>
          <ixx>0.000132</ixx> <!-- 1/12*m*(3r^2 + l^2) -->
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.00025</iyy>  <!-- 1/2*m*r^2 -->
          <iyz>0.0</iyz>
          <izz>0.000132</izz>
        </inertia>
      </inertial>
      <collision name='col'>
        <geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry>
        <surface>
          <friction><ode><mu>1.2</mu><mu2>1.2</mu2></ode></friction>
        </surface>
      </collision>
      <visual name='vis'>
        <geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry>
        <material><ambient>0.05 0.05 0.05 1</ambient></material>
      </visual>
    </link>

    <!-- Front-Right -->
    <link name='wheel_fr'>
      <pose>0.15 -0.12 0.05 1.5707963 0 0</pose>
      <inertial><mass>0.2</mass>
        <inertia><ixx>0.000132</ixx><ixy>0</ixy><ixz>0</ixz><iyy>0.00025</iyy><iyz>0</iyz><izz>0.000132</izz></inertia>
      </inertial>
      <collision name='col'><geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry>
        <surface><friction><ode><mu>1.2</mu><mu2>1.2</mu2></ode></friction></surface></collision>
      <visual name='vis'><geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry></visual>
    </link>

    <!-- Rear-Left -->
    <link name='wheel_rl'>
      <pose>-0.15 0.12 0.05 1.5707963 0 0</pose>
      <inertial><mass>0.2</mass>
        <inertia><ixx>0.000132</ixx><ixy>0</ixy><ixz>0</ixz><iyy>0.00025</iyy><iyz>0</iyz><izz>0.000132</izz></inertia>
      </inertial>
      <collision name='col'><geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry>
        <surface><friction><ode><mu>1.2</mu><mu2>1.2</mu2></ode></friction></surface></collision>
      <visual name='vis'><geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry></visual>
    </link>

    <!-- Rear-Right -->
    <link name='wheel_rr'>
      <pose>-0.15 -0.12 0.05 1.5707963 0 0</pose>
      <inertial><mass>0.2</mass>
        <inertia><ixx>0.000132</ixx><ixy>0</ixy><ixz>0</ixz><iyy>0.00025</iyy><iyz>0</iyz><izz>0.000132</izz></inertia>
      </inertial>
      <collision name='col'><geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry>
        <surface><friction><ode><mu>1.2</mu><mu2>1.2</mu2></ode></friction></surface></collision>
      <visual name='vis'><geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry></visual>
    </link>

    <!-- ===================== Joints (revolute about Y) ===================== -->
    <joint name='joint_wheel_fl' type='revolute'>
      <parent>chassis</parent>
      <child>wheel_fl</child>
      <axis>
        <xyz>0 1 0</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        <dynamics><damping>0.1</damping></dynamics>
      </axis>
    </joint>

    <joint name='joint_wheel_fr' type='revolute'>
      <parent>chassis</parent>
      <child>wheel_fr</child>
      <axis>
        <xyz>0 1 0</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        <dynamics><damping>0.1</damping></dynamics>
      </axis>
    </joint>

    <joint name='joint_wheel_rl' type='revolute'>
      <parent>chassis</parent>
      <child>wheel_rl</child>
      <axis>
        <xyz>0 1 0</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        <dynamics><damping>0.1</damping></dynamics>
      </axis>
    </joint>

    <joint name='joint_wheel_rr' type='revolute'>
      <parent>chassis</parent>
      <child>wheel_rr</child>
      <axis>
        <xyz>0 1 0</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        <dynamics><damping>0.1</damping></dynamics>
      </axis>
    </joint>
    <!-- ============================================================ -->
    <!-- ðŸš— Gazebo ROS Skid-Steer Drive Plugin for keyboard control -->
    <!-- ============================================================ -->
    <plugin name="car_skid_steer" filename="libgazebo_ros_skid_steer_drive.so">
      <ros>
        <namespace>/my_robot</namespace>
        <remapping>cmd_vel:=cmd_vel</remapping>
        <remapping>odom:=odom</remapping>
      </ros>

      <update_rate>50</update_rate>

      <!-- Match your joint names -->
      <left_front_joint>joint_wheel_fl</left_front_joint>
      <left_rear_joint>joint_wheel_rl</left_rear_joint>
      <right_front_joint>joint_wheel_fr</right_front_joint>
      <right_rear_joint>joint_wheel_rr</right_rear_joint>

      <!-- Wheel geometry -->
      <wheel_separation>0.24</wheel_separation>     <!-- y distance between left/right -->
      <wheel_diameter>0.10</wheel_diameter>         <!-- 2 * radius (0.05) -->

      <!-- Performance tuning -->
      <max_wheel_torque>5.0</max_wheel_torque>
      <max_speed>2.0</max_speed>
      <command_timeout>1.0</command_timeout>
    </plugin>
  </model>
</sdf>

