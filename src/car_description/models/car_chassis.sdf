<?xml version='1.0'?>
<sdf version='1.7'>
  <model name='car_with_axles'>
    <static>false</static>

    <link name='chassis_link'>
      <pose>0 0 0.3 0 0 0</pose>
      <inertial>
        <mass>100.0</mass>
        <inertia>
          <ixx>16.3</ixx>
          <iyy>34.0</iyy>
          <izz>48.0</izz>
        </inertia>
      </inertial>
      <visual name='visual'>
        <geometry><box><size>2.0 1.4 0.3</size></box></geometry>
        <material><ambient>0.0 0.0 0.8 1</ambient></material>
      </visual>
      <collision name='collision'>
        <geometry><box><size>2.0 1.4 0.3</size></box></geometry>
        <surface>
          <friction><ode><mu>0.8</mu><mu2>0.8</mu2></ode></friction>
        </surface>
      </collision>
            <!-- ============ ULTRASONIC: LEFT (30° left, near front-left edge) ============ -->
      <visual name="ultra_left_vis">
        <pose>1.015 0.69 -0.14 0 0 0.523599</pose>  <!-- +30° yaw -->
        <geometry>
          <box><size>0.03 0.02 0.02</size></box>
        </geometry>
        <material>
          <ambient>0.1 0.1 0.1 1</ambient>
        </material>
      </visual>

      <sensor name="ultra_left" type="ray">
        <always_on>true</always_on>
        <update_rate>20</update_rate>
        <visualize>true</visualize>
        <pose>1.015 0.69 -0.14 0 0 0.523599</pose> <!-- +30° yaw -->
        <ray>
          <scan>
            <horizontal>
              <samples>16</samples>
              <resolution>1</resolution>
              <min_angle>-0.261799</min_angle>
              <max_angle>0.261799</max_angle>
            </horizontal>
          </scan>
          <range>
            <min>0.10</min>
            <max>4.0</max>
            <resolution>0.01</resolution>
          </range>
          <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>0.01</stddev>
          </noise>
        </ray>
        <plugin name="ultra_left_scan" filename="libgazebo_ros_ray_sensor.so">
          <ros>
            <namespace>/ultrasonic/left</namespace>
            <remapping>~/out:=scan</remapping>
          </ros>
          <frame_name>ultra_left_frame</frame_name>
        </plugin>
      </sensor>

      <!-- ============ ULTRASONIC: RIGHT (30° right, near front-right edge) ============ -->
      <visual name="ultra_right_vis">
        <pose>1.015 -0.69 -0.14 0 0 -0.523599</pose> <!-- -30° yaw -->
        <geometry>
          <box><size>0.03 0.02 0.02</size></box>
        </geometry>
        <material>
          <ambient>0.1 0.1 0.1 1</ambient>
        </material>
      </visual>

      <sensor name="ultra_right" type="ray">
        <always_on>true</always_on>
        <update_rate>20</update_rate>
        <visualize>true</visualize>
        <pose>1.015 -0.69 -0.14 0 0 -0.523599</pose> <!-- -30° yaw -->
        <ray>
          <scan>
            <horizontal>
              <samples>16</samples>
              <resolution>1</resolution>
              <min_angle>-0.261799</min_angle>
              <max_angle>0.261799</max_angle>
            </horizontal>
          </scan>
          <range>
            <min>0.10</min>
            <max>4.0</max>
            <resolution>0.01</resolution>
          </range>
          <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>0.01</stddev>
          </noise>
        </ray>
        <plugin name="ultra_right_scan" filename="libgazebo_ros_ray_sensor.so">
          <ros>
            <namespace>/ultrasonic/right</namespace>
            <remapping>~/out:=scan</remapping>
          </ros>
          <frame_name>ultra_right_frame</frame_name>
        </plugin>
      </sensor>
    </link>

    <link name='front_left_wheel'>
      <pose>0.8 0.75 0.15 0 0 0</pose>
      <inertial><mass>5</mass></inertial>
      <visual name='visual'>
        <pose>0 0 0 1.5707 0 0</pose>
        <geometry><cylinder><radius>0.15</radius><length>0.1</length></cylinder></geometry>
        <material><ambient>0.1 0.1 0.1 1</ambient></material>
      </visual>
      <collision name='collision'>
        <pose>0 0 0 1.5707 0 0</pose>
        <geometry><cylinder><radius>0.15</radius><length>0.1</length></cylinder></geometry>
        <surface>
          <friction><ode><mu>0.05</mu><mu2>0.05</mu2></ode></friction>
          <contact><ode><kp>1e6</kp><kd>2.0</kd></ode></contact>
        </surface>
      </collision>
    </link>

    <link name='front_right_wheel'>
      <pose>0.8 -0.75 0.15 0 0 0</pose>
      <inertial><mass>5</mass></inertial>
      <visual name='visual'>
        <pose>0 0 0 1.5707 0 0</pose>
        <geometry><cylinder><radius>0.15</radius><length>0.1</length></cylinder></geometry>
      </visual>
      <collision name='collision'>
        <pose>0 0 0 1.5707 0 0</pose>
        <geometry><cylinder><radius>0.15</radius><length>0.1</length></cylinder></geometry>
        <surface>
          <friction><ode><mu>0.05</mu><mu2>0.05</mu2></ode></friction>
          <contact><ode><kp>1e6</kp><kd>2.0</kd></ode></contact>
        </surface>
      </collision>
    </link>

    <link name='rear_left_wheel'>
      <pose>-0.8 0.75 0.15 0 0 0</pose>
      <inertial><mass>5</mass></inertial>
      <visual name='visual'>
        <pose>0 0 0 1.5707 0 0</pose>
        <geometry><cylinder><radius>0.15</radius><length>0.1</length></cylinder></geometry>
      </visual>
      <collision name='collision'>
        <pose>0 0 0 1.5707 0 0</pose>
        <geometry><cylinder><radius>0.15</radius><length>0.1</length></cylinder></geometry>
        <surface>
          <friction>
            <ode>
              <mu>1.6</mu><mu2>1.6</mu2>
              <slip1>0.0</slip1><slip2>0.0</slip2>
            </ode>
          </friction>
          <contact><ode><kp>1e6</kp><kd>2.0</kd></ode></contact>
        </surface>
      </collision>
    </link>

    <link name='rear_right_wheel'>
      <pose>-0.8 -0.75 0.15 0 0 0</pose>
      <inertial><mass>5</mass></inertial>
      <visual name='visual'>
        <pose>0 0 0 1.5707 0 0</pose>
        <geometry><cylinder><radius>0.15</radius><length>0.1</length></cylinder></geometry>
      </visual>
      <collision name='collision'>
        <pose>0 0 0 1.5707 0 0</pose>
        <geometry><cylinder><radius>0.15</radius><length>0.1</length></cylinder></geometry>
        <surface>
          <friction>
            <ode>
              <mu>1.6</mu><mu2>1.6</mu2>
              <slip1>0.0</slip1><slip2>0.0</slip2>
            </ode>
          </friction>
          <contact><ode><kp>1e6</kp><kd>2.0</kd></ode></contact>
        </surface>
      </collision>
    </link>

    <joint name='front_left_wheel_joint' type='fixed'>
      <parent>chassis_link</parent>
      <child>front_left_wheel</child>
    </joint>

    <joint name='front_right_wheel_joint' type='fixed'>
      <parent>chassis_link</parent>
      <child>front_right_wheel</child>
    </joint>

    <joint name='rear_left_wheel_joint' type='revolute'>
      <parent>chassis_link</parent>
      <child>rear_left_wheel</child>
      <axis>
        <xyz>0 1 0</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        <dynamics><damping>1.5</damping><friction>0.2</friction></dynamics>
      </axis>
    </joint>

    <joint name='rear_right_wheel_joint' type='revolute'>
      <parent>chassis_link</parent>
      <child>rear_right_wheel</child>
      <axis>
        <xyz>0 1 0</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        <dynamics><damping>1.5</damping><friction>0.2</friction></dynamics>
      </axis>
    </joint>
    
    <plugin name="car_diff_drive" filename="libgazebo_ros_diff_drive.so">
      <ros><namespace>/car_chassis</namespace></ros>
      <left_joint>rear_left_wheel_joint</left_joint>
      <right_joint>rear_right_wheel_joint</right_joint>
      <wheel_separation>1.5</wheel_separation>
      <wheel_radius>0.15</wheel_radius>
      <max_wheel_torque>120.0</max_wheel_torque>
      <max_speed>3.0</max_speed>
      <max_backward_speed>3.0</max_backward_speed>
      <command_timeout>0.20</command_timeout>
    </plugin>

    <!-- ====================== OAK-D PRO CAMERA SYSTEM ====================== -->

    <!-- Camera Mount Link (Mast) -->
    <link name="camera_mount_link">
      <!-- Mount base position on chassis -->
      <pose>0.8 0.0 0.45 0 0 0</pose>

      <inertial>
        <mass>0.30</mass>
        <inertia>
          <ixx>0.0004</ixx><iyy>0.0004</iyy><izz>0.0004</izz>
        </inertia>
      </inertial>

      <!-- Visuals -->
      <visual name="camera_base_vis">
        <pose>0 0 0.01 0 0 0</pose>
        <geometry><box><size>0.05 0.05 0.02</size></box></geometry>
        <material><ambient>0.2 0.2 0.2 1</ambient></material>
      </visual>

      <visual name="camera_mast_vis">
        <pose>0 0 0.065 0 0 0</pose>
        <geometry><box><size>0.02 0.02 0.11</size></box></geometry>
        <material><ambient>0.1 0.1 0.1 1</ambient></material>
      </visual>

      <!-- Collisions -->
      <collision name="camera_base_col">
        <pose>0 0 0.01 0 0 0</pose>
        <geometry><box><size>0.05 0.05 0.02</size></box></geometry>
      </collision>

      <collision name="camera_mast_col">
        <pose>0 0 0.065 0 0 0</pose>
        <geometry><box><size>0.02 0.02 0.11</size></box></geometry>
      </collision>

      <self_collide>false</self_collide>
    </link>

    <!-- Mount fixed to chassis -->
    <joint name="camera_mount_joint" type="fixed">
      <parent>chassis_link</parent>
      <child>camera_mount_link</child>
      <physics><ode><erp>0.2</erp><cfm>0.0</cfm></ode></physics>
    </joint>

    <!-- ==================== MAIN CAMERA LINK (OAK-D Pro) ==================== -->
    <link name="camera_link">
      <pose relative_to="camera_mount_link">0 0 0.13 0 0 0</pose>

      <inertial>
        <mass>0.25</mass>
        <inertia>
          <ixx>0.0003</ixx><iyy>0.0003</iyy><izz>0.0003</izz>
        </inertia>
      </inertial>

      <gravity>false</gravity>

      <!-- Camera body -->
      <visual name="camera_body_vis">
        <geometry><box><size>0.10 0.04 0.04</size></box></geometry>
        <material><ambient>0.05 0.05 0.05 1</ambient></material>
      </visual>

      <collision name="camera_body_col">
        <geometry><box><size>0.10 0.04 0.04</size></box></geometry>
      </collision>

      <!-- ==================== RGB COLOR CAMERA ==================== -->
      <sensor name="oak_color" type="camera">
        <always_on>true</always_on>
        <update_rate>60</update_rate>
        <visualize>true</visualize>
        <camera>
          <horizontal_fov>1.204</horizontal_fov>
          <image>
            <width>1920</width>
            <height>1080</height>
            <format>R8G8B8</format>
          </image>
          <clip>
            <near>0.08</near>
            <far>100.0</far>
          </clip>
          <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>0.005</stddev>
          </noise>
          <distortion>
            <k1>-0.02</k1>
            <k2>0.005</k2>
            <k3>0.0</k3>
            <p1>0.0</p1>
            <p2>0.0</p2>
            <center>0.5 0.5</center>
          </distortion>
          <lens>
            <type>custom</type>
            <scale_to_hfov>true</scale_to_hfov>
            <custom_function>
              <c1>1.05</c1>
              <c2>4</c2>
              <f>1.0</f>
              <fun>tan</fun>
            </custom_function>
          </lens>
        </camera>
        <plugin name="oak_color_ros" filename="libgazebo_ros_camera.so">
          <ros><namespace>oak/color</namespace></ros>
          <frame_name>oak_rgb_camera_optical_frame</frame_name>
          <hack_baseline>0.075</hack_baseline>
          <min_depth>0.08</min_depth>
          <max_depth>100.0</max_depth>
        </plugin>
      </sensor>

      <!-- ==================== STEREO DEPTH CAMERA (OV9282 Pair) ==================== -->
      <sensor name="oak_depth" type="depth">
        <always_on>true</always_on>
        <update_rate>60</update_rate>
        <visualize>true</visualize>
        <camera>
          <horizontal_fov>1.253</horizontal_fov>
          <image>
            <width>1280</width>
            <height>800</height>
            <format>R_FLOAT32</format>
          </image>
          <clip>
            <near>0.20</near>
            <far>35.0</far>
          </clip>
          <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>0.015</stddev>
          </noise>
        </camera>
        <plugin name="oak_depth_ros" filename="libgazebo_ros_camera.so">
          <ros><namespace>oak/depth</namespace></ros>
          <frame_name>oak_depth_optical_frame</frame_name>
          <hack_baseline>0.075</hack_baseline>
          <min_depth>0.20</min_depth>
          <max_depth>35.0</max_depth>
          <point_cloud_cutoff>0.20</point_cloud_cutoff>
        </plugin>
      </sensor>

      <!-- ==================== LEFT STEREO CAMERA ==================== -->
      <sensor name="oak_left" type="camera">
        <always_on>true</always_on>
        <update_rate>60</update_rate>
        <visualize>false</visualize>
        <pose>-0.0375 0 0 0 0 0</pose>
        <camera>
          <horizontal_fov>1.253</horizontal_fov>
          <image>
            <width>1280</width>
            <height>800</height>
            <format>L8</format>
          </image>
          <clip>
            <near>0.20</near>
            <far>35.0</far>
          </clip>
        </camera>
        <plugin name="oak_left_ros" filename="libgazebo_ros_camera.so">
          <ros><namespace>oak/left</namespace></ros>
          <frame_name>oak_left_camera_optical_frame</frame_name>
        </plugin>
      </sensor>

      <!-- ==================== RIGHT STEREO CAMERA ==================== -->
      <sensor name="oak_right" type="camera">
        <always_on>true</always_on>
        <update_rate>60</update_rate>
        <visualize>false</visualize>
        <pose>0.0375 0 0 0 0 0</pose>
        <camera>
          <horizontal_fov>1.253</horizontal_fov>
          <image>
            <width>1280</width>
            <height>800</height>
            <format>L8</format>
          </image>
          <clip>
            <near>0.20</near>
            <far>35.0</far>
          </clip>
        </camera>
        <plugin name="oak_right_ros" filename="libgazebo_ros_camera.so">
          <ros><namespace>oak/right</namespace></ros>
          <frame_name>oak_right_camera_optical_frame</frame_name>
        </plugin>
      </sensor>

      <!-- ==================== IMU SENSOR (BNO085) ==================== -->
      <sensor name="oak_imu" type="imu">
        <always_on>true</always_on>
        <update_rate>100</update_rate>
        <visualize>false</visualize>
        <imu>
          <angular_velocity>
            <x><noise type="gaussian"><mean>0.0</mean><stddev>0.0002</stddev></noise></x>
            <y><noise type="gaussian"><mean>0.0</mean><stddev>0.0002</stddev></noise></y>
            <z><noise type="gaussian"><mean>0.0</mean><stddev>0.0002</stddev></noise></z>
          </angular_velocity>
          <linear_acceleration>
            <x><noise type="gaussian"><mean>0.0</mean><stddev>0.017</stddev></noise></x>
            <y><noise type="gaussian"><mean>0.0</mean><stddev>0.017</stddev></noise></y>
            <z><noise type="gaussian"><mean>0.0</mean><stddev>0.017</stddev></noise></z>
          </linear_acceleration>
        </imu>
        <plugin name="oak_imu_plugin" filename="libgazebo_ros_imu_sensor.so">
          <ros><namespace>oak</namespace></ros>
          <frame_name>oak_imu_frame</frame_name>
          <initial_orientation_as_reference>false</initial_orientation_as_reference>
        </plugin>
      </sensor>
    </link>

    <!-- Camera fixed to mast -->
    <joint name="camera_fixed_to_mount" type="fixed">
      <parent>camera_mount_link</parent>
      <child>camera_link</child>
      <physics><ode><erp>0.2</erp><cfm>0.0</cfm></ode></physics>
    </joint>
  </model>
</sdf>
